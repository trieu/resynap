flowchart TD
  subgraph Personalization_Flow["Personalization_Flow"]
        DB["ðŸ›¢ï¸ PostgreSQL DB"]
        A1["ðŸ“£ Campaign Trigger or ðŸ§User Action"]
        A2["ðŸŽ›ï¸ AI Agent Orchestrator"]
        A3["ðŸ—ƒï¸ Fetch Profile"]
        A4["ðŸ§  RAG Module"]
        A5["ðŸ”Ž Query Vector DB for Relevant Context"]
        A6["ðŸ¤– GenAI"]
        A7["ðŸ“ Personalized Content"]
  end

  subgraph Communication_Flow["Communication_Flow"]
        B1["ðŸ“Š Analyze Channel Preferences"]
        B2{"Which Channel?"}
        C1["ðŸ“² Send via Real-Time API"]
        C2["ðŸ“§ Send via Mail API"]
        C3["ðŸŽ¯ Send Audience to Ads Platform"]
        D1["âœ… Delivered to Customer"]
        D2["ðŸ“¥ Engagement Feedback"]
        E1["ðŸ› ï¸ Update Customer Profile in PostgreSQL"]
        F1["ðŸ“¤ Feedback Agent"]
  end

    A1 --> A2
    A2 --> DB
    DB --> A3
    A3 --> A4
    A4 --> A5
    A5 --> A6
    A6 --> A7
    A7 --> A2
    A2 --> B1

    B1 --> B2
    B2 -- PushNotification --> C1
    B2 -- Email/SMS --> C2
    B2 -- Ads --> C3
    C1 --> D1
    C2 --> D1
    C3 --> D1
    D1 --> D2
    D2 --> E1
    E1 --> F1
    F1 --> DB

    classDef blue fill:#e0f7fa,stroke:#0288d1,stroke-width:1px
    classDef green fill:#e8f5e9,stroke:#2e7d32,stroke-width:1px
