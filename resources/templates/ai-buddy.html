<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1, maximum-scale=5">
    <base href="//{{ CHATBOT_HOSTNAME }}/">

    <link rel="icon" type="image/x-icon" href="resources/images/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="resources/images/android-chrome-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="resources/images/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="resources/images/favicon-16x16.png">
	<link rel="mask-icon" href="resources/images/favicon.ico" color="#5bbad5">
    
    <!-- META FOR FACEBOOK -->
    <meta property="og:site_name" content="leobot.leocdp.com"/>
    <meta property="og:rich_attachment" content="true"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" itemprop="url" content="https://leobot.leocdp.com"/>
    <meta property="og:image" itemprop="thumbnailUrl" content="https://cdn.jsdelivr.net/gh/USPA-Technology/leo-cdp-static-files@latest/images/leo-cdp-logo.png"/>
    <meta property="og:image:width" content="833"/>
    <meta property="og:image:height" content="237"/>
    <meta content="ReSynap - The Smart ChatBot AI for daily tasks" itemprop="headline" property="og:title"/>
    <meta content="The AI bot created by Trieu Dataism" itemprop="description" property="og:description"/>
    <!-- END META FOR FACEBOOK -->

    <!-- META FOR ReSynap -->
    <title> {{CHATBOT_NAME}} </title>
    <meta name="robots" content="all">
    <meta name="author" content="Trieu Dataism">
    <meta name="keywords" content="Chatbot, AI Agent"/>
    <meta name="description" content="ReSynap AI bot created by Trieu Dataism"/>
    <!-- END META FOR ReSynap -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

    <style>
        /* Default: Dark Theme Variables */
        :root {
            --bg-color: #2a1a3d;
            --text-color: #f8f9fa;
            --text-muted-color: #adb5bd;
            --component-bg-color: rgba(255, 255, 255, 0.08);
            --component-border-color: rgba(255, 255, 255, 0.15);
            --component-hover-bg-color: rgba(255, 255, 255, 0.15);
            --navbar-bg: rgba(0, 0, 0, 0.1);
            --navbar-text-color: #f8f9fa;
            --input-placeholder-color: #adb5bd;
            --icon-color: #adb5bd;
            --icon-hover-color: #f8f9fa;
            --gradient-bg: none;
            /* No gradient for dark */
        }

        /* Light Theme Variables */
        body.light {
            --bg-color: #ffffff;
            /* Top color of gradient */
            --text-color: #212529;
            /* Bootstrap dark text */
            --text-muted-color: #6c757d;
            /* Bootstrap secondary text */
            --component-bg-color: rgba(0, 0, 0, 0.03);
            /* Lighter component bg */
            --component-border-color: rgba(0, 0, 0, 0.1);
            --component-hover-bg-color: rgba(0, 0, 0, 0.06);
            --navbar-bg: rgba(255, 255, 255, 0.8);
            /* Semi-transparent white */
            --navbar-text-color: #212529;
            --input-placeholder-color: #6c757d;
            --icon-color: #6c757d;
            --icon-hover-color: #212529;
            /* Light mode gradient from user code */
            --gradient-bg: linear-gradient(180deg,
                    rgb(255, 255, 255),
                    rgb(232, 189, 250));
        }

        /* Apply variables */
        body {
            background-color: var(--bg-color);
            /* Base color */
            background-image: var(--gradient-bg);
            /* Apply gradient if defined */
            background-attachment: fixed;
            /* Keep gradient fixed */
            background-size: cover;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
            /* Smooth transition */
        }

        .navbar {
            background-color: var(--navbar-bg);
            transition: background-color 0.3s ease;
            backdrop-filter: blur(5px);
            /* Optional: Add blur for transparent navbar */
        }

        .navbar-brand {
            font-size:25px;
        }

        /* Ensure navbar text/links/button adapt */
        .navbar .navbar-brand,
        .navbar .btn-theme-toggle {
            /* Style the toggle button */
            color: var(--navbar-text-color);
            transition: color 0.3s ease;
        }

        .navbar .btn-theme-toggle:hover {
            opacity: 0.8;
        }

        /* Adjust user icon color */
        .user-icon a {
            font-size: 1.5rem;
            color: var(--icon-color);
            /* Use icon color var */
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .user-icon a:hover {
            color: var(--icon-hover-color);
        }

        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .main-content h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            /* Text color comes from body */
        }

        .main-content h2,
        .main-content p.lead {
            color: var(--text-muted-color);
            transition: color 0.3s ease;
        }

        .main-content h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .main-content p.lead {
            font-size: 1rem;
            margin-bottom: 2.5rem;
        }

        .suggestion-btn {
            background-color: var(--component-bg-color);
            border: 1px solid var(--component-border-color);
            color: var(--text-color);
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-size: 0.9rem;
            transition: background-color 0.2s ease, border-color 0.2s ease,
                color 0.2s ease;
        }

        .suggestion-btn:hover,
        .suggestion-btn:focus {
            background-color: var(--component-hover-bg-color);
            color: var(--text-color);
            border-color: var(--component-border-color);
            /* Keep consistent or slightly darken/lighten */
        }

        .chat-input-section {
            margin-top: auto;
            padding-bottom: 1rem;
        }

        .chat-input-group {
            background-color: var(--component-bg-color);
            border: 1px solid var(--component-border-color);
            border-radius: 10px;
            padding: 0.5rem 0.75rem;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .chat-input-group .form-control {
            background-color: transparent;
            border: none;
            color: var(--text-color);
            box-shadow: none;
            transition: color 0.3s ease;
        }

        .chat-input-group .form-control::placeholder {
            color: var(--input-placeholder-color);
            opacity: 1;
            transition: color 0.3s ease;
        }

        .chat-input-group .btn {
            background-color: transparent;
            border: none;
            color: var(--icon-color);
            font-size: 1.1rem;
            padding: 0 0.5rem;
            transition: color 0.3s ease;
        }

        .chat-input-group .btn:hover,
        .chat-input-group .btn:focus {
            color: var(--icon-hover-color);
            box-shadow: none;
        }

        .chat-input-group .btn-send {
            padding-right: 0;
        }

        .footer-link a {
            color: var(--text-muted-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .footer-link a:hover {
            color: var(--text-color);
        }

        .footer-link i {
            vertical-align: middle;
            font-size: 1.1rem;
            color: var(--icon-color);
            /* Ensure icon color matches link */
            transition: color 0.3s ease;
        }

        .offcanvas {
            max-width: 320px;
        }
        .profile-pic {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }
        .menu-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s;
        }
        .menu-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        /* botui  */
        .botui-container {
            background-color: transparent !important;
            border: none !important;
            box-shadow: none !important;
            border-radius: 0 !important;
        }
        .botui-message-content.html{
            width: 100%!important;
        }
        .botui-message-content span {
            line-height: 22px !important;
        }
        
        #chatbot_container {
            width: 100% !important;
            height: 400px !important;
            overflow-y: scroll !important;
            margin-bottom: 20px !important;
        }
        
        .leobot-question-input {
            width: 76% !important;
            box-shadow: 0 0 6px #0045fe;
            display: inline-block !important;
        }
        
        .botui-action-text-icon {
            display: inline-block !important;
            font-size: 18px !important;
        }
        
        #chatbot_info_box {
            display: inline-block !important;
            font-size: 12.8px !important;
            width: 100% !important;
            color: #000 !important;
        }
        
        div.chatbot_answer .botui-message-content {
            color: #000 !important;
        }
        
        div.chatbot-error .botui-message-content {
            color: red !important;
            border: 1px solid red;
        }
        
        div.leobot-question .botui-message-content {
            color: blue !important;
            border: 1px solid blue;
        }
        
        .botui-container {
            font-size: 14.2px !important;
        }
        
        /* ajax loader  */
        .loader {
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid blue;
            border-bottom: 16px solid blue;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
            margin: auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
          
    </style>

    <!-- JQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- BotUI CSS and JS  -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/botui/0.3.9/botui.min.css" rel="stylesheet" type="text/css" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/botui/0.3.9/botui-theme-default.css" rel="stylesheet" type="text/css" crossorigin="anonymous" referrerpolicy="no-referrer"/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.7.14/vue.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/botui/0.3.9/botui.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
</head>

<body>
    <nav class="navbar navbar-expand">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-robot me-2"></i> AI Buddy 
            </a>
            <div class="ms-auto d-flex align-items-center">
                <button class="btn btn-link btn-theme-toggle me-3" id="theme-toggle-btn" type="button"
                    aria-label="Toggle theme">
                    <i class="bi" id="theme-icon"></i>
                </button>
                <div class="user-icon">
                    <a href="#" data-bs-toggle="offcanvas" data-bs-target="#settingsPanel" ><i class="bi bi-person-circle"></i></a>
                </div>
                
            </div>
        </div>
    </nav>

    <main class="container main-content py-4">
        <div class="text-center" id="hello_panel" style="display: none;">
            <h1>Xin chào, <span id="user_first_name"> người lạ </span> !</h1>
            <h2>Tôi có thể giúp gì cho bạn?</h2>
            <p class="lead">Bạn có thể tâm sự với tôi về bất cứ điều gì</p>

            <div class="d-flex justify-content-center flex-wrap gap-2 mb-5" >
                <button class="btn suggestion-btn">Stress</button>
                <button class="btn suggestion-btn">Tâm sự</button>
                <button class="btn suggestion-btn">Cung hoàng đạo</button>
                <button class="btn suggestion-btn">Sức khỏe</button>
            </div>
            
        </div>

        <!-- MAIN CHATBOT UI -->
        <div class="botui-app-container flex-grow-1 d-flex flex-column overflow-auto" id="chatbot_container" style="display:none" >
            <bot-ui></bot-ui>
        </div>
    </main>

    <section class="chat-input-section container">
        <div class="input-group chat-input-group mb-3 align-items-center">
            <button class="btn" type="button" aria-label="Record voice message" style="display: none;">
                <i class="bi bi-mic-fill"></i>
            </button>
            <button class="btn" type="button" aria-label="Attach file">
                <i class="bi bi-paperclip"></i>
            </button>            
            <textarea id="chatbot_input" class="form-control" rows="2" placeholder="Hãy gửi tin nhắn cho tôi..." 
                style="resize: none;" aria-label="Chat message input"></textarea>
            <button class="btn btn-send" type="button" aria-label="Send message" id="sendBtn" onclick="sendToChatbot()" >
                <i class="bi bi-send-fill"></i>
            </button>
        </div>

        <div class="text-center footer-link">
            <a href="#" onclick="gotoPublicChatMode(true)" style="display: block;" id="btn-toggle-private-chat">
                <i class="bi bi-incognito me-1"></i> Tắt chế độ ẩn danh
                <i class="bi bi-chevron-down ms-1"></i>
            </a>
            <a href="#" onclick="gotoPrivateChatMode(true)" style="display: none;" id="btn-toggle-public-chat">
                <i class="bi bi-person-circle"></i> Bật chế độ ẩn danh
                <i class="bi bi-chevron-up ms-1"></i>
            </a>
        </div>
    </section>

    <!-- Offcanvas Sidebar for Settings -->
    <div class="offcanvas offcanvas-end" id="settingsPanel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Cài đặt</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div class="text-center">
                <img src="https://img.freepik.com/free-vector/smiling-young-man-illustration_1308-173524.jpg" class="profile-pic">
                <h6 class="mt-2">Anh Tuấn Tí Tởn</h6>
            </div>
            <hr>
            <div class="menu-item">
                <i class="bi bi-person me-2"></i> Chọn Buddy của bạn               
            </div>
            <div class="menu-item">
                <select id="chatbot_persona_name" class="form-select" style="display:none" >
                    {% for lang in persona_agent_list %}
                    <option value="{{ lang.code }}" {% if lang.selected %}selected="selected"{% endif %}>
                        {{ lang.label }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="menu-item">
                <i class="bi bi-eye-slash me-2"></i> Bật chế độ ẩn danh
            </div>
            <hr>
            <h6>Đã lưu</h6>
             
            <div>
                <!-- Public chat history -->
                {% for item in menu_items %}
                    <div class="menu-item">
                        <a id="{{ item.id }}" class="nav-link {% if item.active %}active{% endif %}" 
                            title="{{ item.name }}"
                            onclick="loadSelectedChatSession(this)" href="#chat_session_{{ item.id }}" >
                                <i class="bi bi-chat-right-dots"></i> 
                                {{ item.name }}
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
  
        const themeIcon = document.getElementById("theme-icon");
       
        const currentTheme = localStorage.getItem("theme")? localStorage.getItem("theme"): "dark"; // Default to dark
        window.inPrivateMode = currentTheme === 'dark';

        var gotoPrivateChatMode = function (newSession) {
            $( 'body' ).addClass("dark").removeClass("light");
            $('#btn-toggle-private-chat').show();
            $('#btn-toggle-public-chat').hide();
            window.inPrivateMode = true;

            // Determine the new theme
            let newTheme = "dark";

            // Update the icon
            themeIcon.classList.toggle("bi-sun-fill", newTheme === "dark");
            themeIcon.classList.toggle("bi-moon-stars-fill", newTheme === "light");

            // Save the preference to localStorage
            localStorage.setItem("theme", newTheme);

            if(newSession){
                newChatbotSession()
            }
        }

        var gotoPublicChatMode = function (newSession) {
            $( 'body' ).addClass("light").removeClass("dark");
            $('#btn-toggle-private-chat').hide();
            $('#btn-toggle-public-chat').show();
            window.inPrivateMode = false;

            // Determine the new theme
            let newTheme = "light";

            // Update the icon
            themeIcon.classList.toggle("bi-sun-fill", newTheme === "dark");
            themeIcon.classList.toggle("bi-moon-stars-fill", newTheme === "light");

            // Save the preference to localStorage
            localStorage.setItem("theme", newTheme);

            if(newSession){
                newChatbotSession()
            }
        }

       
        window.sayHelloToUser = function(displayName){
            $('#hello_panel').show()
            
             // Apply the current theme on load
            if (window.inPrivateMode) {
                gotoPrivateChatMode()
                $('#user_first_name').text('người lạ')
            } else {
                gotoPublicChatMode()
                $('#user_first_name').text(displayName)
            }
     
        }
    </script>

     <!-- ReSynap Chatbot CONFIGS -->
     <script>
        const CHATBOT_HOSTNAME = '{{ CHATBOT_HOSTNAME }}';
        const CHATBOT_DEV_MODE = '{{ CHATBOT_DEV_MODE }}' === "True";
        const BASE_URL_API = location.protocol + '//' + CHATBOT_HOSTNAME + '/ask';    
        const BASE_URL_GET_VISITOR_INFO = location.protocol + '//' + CHATBOT_HOSTNAME + '/get-visitor-info';
        const CDP_TRACKING = ! CHATBOT_DEV_MODE;

        // 
        window.loadInitTracking = function(){
           // local DEV server
           if (CHATBOT_DEV_MODE) {
               console.log('CHATBOT_DEV_MODE: ', CHATBOT_DEV_MODE);           
               
               window.leoObserverId = "3PTSSCP1IK8gPhzrWIq8hy";
               window.leoObserverLogDomain = "obs.example.com";
               window.leoObserverCdnDomain = "leocdp.example.com/public";
           } 
           // Production server
           else if (location.host === "leobot.leocdp.com") {
               
               window.leoObserverId = "7OISrL5a6Jbqc0UaXYZVvQ";
               window.leoObserverLogDomain = "datahub4uspa.leocdp.net";
               window.leoObserverCdnDomain = "cdn.jsdelivr.net/gh/USPA-Technology/leo-cdp-static-files@v0.8.9.21";
               return true;
           } 
             // skip tracking
           else {             
               return false;
           }
        }
    </script>

    <script src="/resources/js/resynap.chatbot.js?_={{ timestamp }}" async ></script>
</body>

</html>